No human steps needed for this audit.

â¸»

Quick Health Audit â€” Replit Agent

Run this as-is in the project root. It wonâ€™t stop your dev servers or mutate files; it just checks and reports.

#!/usr/bin/env bash
set +e

echo "ğŸ©º Content Radar â€“ Quick Health Audit ($(date -u +'%Y-%m-%d %H:%M:%S UTC'))"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

pass=0; fail=0; warn=0

check () {
  local name="$1"; shift
  if eval "$@"; then
    printf "âœ… %s\n" "$name"; pass=$((pass+1))
  else
    printf "âŒ %s\n" "$name"; fail=$((fail+1))
  fi
}

warnf () {
  printf "âš ï¸  %s\n" "$1"; warn=$((warn+1))
}

# 0) Runtime & scripts
echo "â€¢ Runtime & scripts"
node -v 2>/dev/null || true
npm -v 2>/dev/null || true
echo "Scripts:" && node -e 'try{console.log(require("./package.json").scripts)}catch(e){process.exit(0)}' || true
echo

# 1) Process / ports (non-fatal if missing)
echo "â€¢ Process/port presence"
pgrep -fa "vite --host" >/dev/null 2>&1 && echo "   vite dev: running" || echo "   vite dev: not running"
pgrep -fa "tsx server/index.ts" >/dev/null 2>&1 && echo "   server:   running" || echo "   server:   not running"
# Some environments lack lsof; try both
(lsof -i :5175 -sTCP:LISTEN 2>/dev/null || ss -ltn 2>/dev/null | awk '$4 ~ /:5175$/'){ true; } && echo "   :5175 (vite): listening" || echo "   :5175 (vite): no listener"
(lsof -i :5001 -sTCP:LISTEN 2>/dev/null || ss -ltn 2>/dev/null | awk '$4 ~ /:5001$/'){ true; } && echo "   :5001 (api):  listening" || echo "   :5001 (api):  no listener"
echo

# 2) API health (direct)
echo "â€¢ API health (direct â†’ http://localhost:5001/healthz)"
api_json="$(curl -s --max-time 3 http://localhost:5001/healthz)"
if echo "$api_json" | grep -q '"status":"ok"'; then
  echo "   $api_json"
  ((pass++)); echo "âœ… API /healthz"
else
  echo "   (no/invalid response) $api_json"
  ((fail++)); echo "âŒ API /healthz"
fi
echo

# 3) Vite dev â†’ proxy health (http://localhost:5175/api/healthz)
echo "â€¢ Vite proxy health (â†’ http://localhost:5175/api/healthz)"
proxy_json="$(curl -s --max-time 3 http://localhost:5175/api/healthz)"
if echo "$proxy_json" | grep -q '"status":"ok"'; then
  echo "   $proxy_json"
  ((pass++)); echo "âœ… Vite proxy /api/healthz"
else
  echo "   (no/invalid response) $proxy_json"
  ((fail++)); echo "âŒ Vite proxy /api/healthz"
fi
echo

# 4) Dev index served (http://localhost:5175/)
echo "â€¢ Vite index (â†’ http://localhost:5175/)"
code=$(curl -s -o /dev/null -w "%{http_code}" --max-time 3 http://localhost:5175/)
[ "$code" = "200" ] && echo "   HTTP $code" || echo "   HTTP $code"
[ "$code" = "200" ] && ((pass++)) && echo "âœ… Vite index /" || ((fail++)) && echo "âŒ Vite index /"
echo

# 5) CORS header sanity (Origin: http://localhost:3000 â†’ API /healthz)
echo "â€¢ CORS sanity (Origin=http://localhost:3000 â†’ API /healthz)"
cors_headers="$(curl -s -D - -o /dev/null -H 'Origin: http://localhost:3000' http://localhost:5001/healthz)"
if echo "$cors_headers" | grep -i -q 'access-control-allow-origin'; then
  echo "$cors_headers" | grep -i 'access-control-allow-origin' | sed 's/^/   /'
  ((pass++)); echo "âœ… CORS header present"
else
  ((warn++)); echo "âš ï¸  No ACAO header detected (may be expected if CORS only applied on /api/*)"
fi
echo

# 6) Vite allowedHosts presence
echo "â€¢ Vite allowedHosts presence in vite.config.ts"
if grep -n "allowedHosts" vite.config.ts >/dev/null 2>&1; then
  grep -n "allowedHosts" vite.config.ts | sed 's/^/   /'
  ((pass++)); echo "âœ… allowedHosts configured"
else
  ((warn++)); echo "âš ï¸  allowedHosts not found in vite.config.ts (ok if already working in Preview)"
fi
echo

# 7) TypeScript check (non-blocking)
echo "â€¢ TypeScript typecheck"
npm run -s typecheck >/tmp/tsc.out 2>&1
tscode=$?
if [ $tscode -eq 0 ]; then
  ((pass++)); echo "âœ… tsc clean"
else
  ((warn++)); echo "âš ï¸  tsc reported issues (see /tmp/tsc.out)"
  tail -n 20 /tmp/tsc.out || true
fi
echo

# 8) Build dry-run (non-blocking, does not start prod)
echo "â€¢ Build dry-run (vite build)"
npm run -s build >/tmp/build.out 2>&1
bcode=$?
if [ $bcode -eq 0 ]; then
  ((pass++)); echo "âœ… build ok"
  # list artifacts briefly
  ls -l dist 2>/dev/null | sed 's/^/   /' || true
else
  ((warn++)); echo "âš ï¸  build had issues (see /tmp/build.out)"
  tail -n 30 /tmp/build.out || true
fi
echo

# 9) Optional API surface pings (wonâ€™t fail audit if they 404)
echo "â€¢ Optional API surface probes"
for u in /api/projects /api/briefs /api/moments /api/truth/health; do
  code=$(curl -s -o /dev/null -w "%{http_code}" --max-time 3 "http://localhost:5001$u")
  echo "   $u â†’ HTTP $code"
done
echo

# Summary
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "Summary: $pass passed, $warn warnings, $fail failed"
[ $fail -eq 0 ] && exit 0 || exit 1

How to read the results
	â€¢	Green checks = confirmed working right now.
	â€¢	Warnings = non-blocking (e.g., CORS header not present on non-/api routes, or typecheck/build needs attention but dev can still run).
	â€¢	Fails = something is unreachable or misconfigured (usually a stopped dev server, port mismatch, or Vite proxy mis-wire).

Paste the final â€œSummaryâ€ line and any failing section outputs here, and Iâ€™ll tell you exactly what to fix next.