Awesome—here’s Step 23: API contract harmonization (client ⇄ server) as a tight, do-this-now set of edits + verifications. It keeps /healthz as-is, and adds compat alias routes so any legacy client/extension calls won’t 404.

⸻

Step 23 — Add route aliases + keep health endpoint clean

Goal
	•	Keep server health at /healthz (no /api/healthz).
	•	Add compatibility routes so old clients calling /api/truth_checks/* continue to work by delegating to the new /api/truth/* handlers.

⸻

23.1 Create a dedicated compat router

File: server/routes/compat-truth.ts (new)

import { Router } from "express";

/**
 * Compat router mapping legacy `/api/truth_checks/*` calls
 * to the current `/api/truth/*` endpoints.
 *
 * Assumes your main truth routes are mounted under `/api/truth`.
 * We simply re-forward requests with identical method/body/query.
 */
export default function registerTruthCompat(app: import("express").Express) {
  const r = Router();

  // POST /api/truth_checks/run  →  POST /api/truth/run
  r.post("/truth_checks/run", (req, res, next) => {
    // rewrite URL and pass through same handler chain
    req.url = "/truth/run";
    next();
  });

  // GET /api/truth_checks/:id  →  GET /api/truth/:id
  r.get("/truth_checks/:id", (req, res, next) => {
    req.url = `/truth/${req.params.id}`;
    next();
  });

  // (Optional) GET /api/truth_checks → /api/truth
  r.get("/truth_checks", (req, res, next) => {
    req.url = "/truth";
    next();
  });

  // Mount under /api so the rewrites above resolve correctly
  app.use("/api", r);
}


⸻

23.2 Register the compat router in your main routes index

File: server/routes/index.ts (edit)
	1.	Import and register the compat router after you mount the real truth routes:

// …existing imports
import registerTruthCompat from "./compat-truth";

// inside your exported function that takes `app`:
// 1) mount current truth routes first (whatever you already do)
//    e.g. registerTruthRoutes(app);

// 2) NOW mount the compat aliases:
registerTruthCompat(app);

If your file exports individual routers instead of a function, just ensure registerTruthCompat(app) runs after the real truth router is mounted under /api/truth.

⸻

